\input{../../preamble}
\title{Toybox Bug Analysis}
\author{Austin Mordahl}
\begin{document}
\maketitle
\tableofcontents

\section{Introduction}
\noindent These bugs were generated by Cppcheck 1.72 and Toybox 0.7.5.
Bug reports are classified into the following categories:

\input{../../bug_classifications}

\pagebreak
\section{True Reports}
\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & blockdev.c \\
  Line & 60 \\
  Description & Array \texttt{cmds[11]} accessed at index 31, which is out of bounds.\\
  Number of Configurations & 482 \\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=52-64, firstnumber=52]{code/blockdev.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & True \\
  Remarks & \texttt{cmd[]} is defined as an integer array of size 11. By using a loop that iterates through the number 31 to access the loop, the program is exceeding the bounds of the array. \\
  Features & CONFIG\_BLOCKDEV \\
  \bottomrule
\end{tabularx}

\pagebreak

\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & netstat.c\\
  Line & 118\\
  Description & {Resource leak: \texttt{fp}}\\
  Number of Configurations & {515}\\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=111-118, firstnumber=111]{code/netstat.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & True\\
  Remarks & \texttt{fp} is not closed before the function returns.\\
  Features & CONFIG\_NETSTAT \\
  \bottomrule
\end{tabularx}

\pagebreak	

\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & cmp.c \\
  Line & 83 \\
  Description & Signed integer overflow for expression \texttt{(2147483648)*!(toys.optflags\&(1))}. \\
  Number of Configurations & 501 \\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=80-85, firstnumber=80]{code/cmp.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule 
  Status & True \\
  Remarks & The multiplication of the flags will cause integer overflow. \\
  Features & CONFIG\_CMP \\
  \bottomrule
\end{tabularx}

\pagebreak

\section{Technically True Reports}
\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & chvt.c \\
  Line & 24 \\
  Description & Uninitialized variable: \texttt{fd} \\
  Number of Configurations & 512 \\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=22-34, firstnumber=22]{code/chvt.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & Technically True \\
  Remarks & The self-assignment \texttt{fd=fd} is likely purposeful, as a method to suppress compiler warnings about an unused variable \texttt{fd} before the rest of \texttt{chvt\_main} was written to use \texttt{fd}. However, cppcheck is correct in that \texttt{fd\= fd} is an assignment of the value of an uninitialized variable.\\
  Feature & CONFIG\_CHVT \\
  \bottomrule
\end{tabularx}

\pagebreak

\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & date.c \\
  Line & 137 \\
  Description & Uninitialized variable: \texttt{width}\\
  Number of Configurations & 511 \\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=134-160, firstnumber=134]{code/date.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & Technically True \\
  Remarks & See the report for \texttt{chvt.c:24}.\\
  Features & CONFIG\_DATE \\
  \bottomrule
\end{tabularx}

\pagebreak
\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & hwclock.c\\
  Line & 89\\
  Description & Uninitialized variable: \texttt{s}\\
  Number of Configurations & 466\\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=88-98, firstnumber=88]{code/hwclock.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & Technically True\\
  Remarks & See the report for \texttt{chvt.c:24}.\\
  Features & CONFIG\_HWCLOCK \\
  \bottomrule
\end{tabularx}

\pagebreak

\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & losetup.c\\
  Line & 64\\
  Description & Uninitialized variable: \texttt{ffd}\\
  Number of Configurations & 531\\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=63-69, firstnumber=63]{code/losetup.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & Technically True\\
  Remarks & See the report for \texttt{chvt.c:24}.\\
  Features & CONFIG\_LOSETUP \\
  \bottomrule
\end{tabularx}

\pagebreak

\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & switch\_root.c\\
  Line & 49\\
  Description & Uninitialized variable: \texttt{console}\\
  Number of Configurations & 486\\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=46-49, firstnumber=46]{code/switch_root.c}
\noindent\lstinputlisting[linerange=81-84, firstnumber=81]{code/switch_root.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & Technically True\\
  Remarks & See the report for \texttt{chvt.c:24}.\\
  Features & CONFIG\_SWITCH\_ROOT \\
  \bottomrule
\end{tabularx}

\pagebreak

\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & uudecode.c\\
  Line & 29\\
  Description & Uninitialized variable: \texttt{m}\\
  Number of Configurations & 485\\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=29-43, firstnumber=29]{code/uudecode.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & Technically True\\
  Remarks & See the report for \texttt{chvt.c:24}.\\
  Features & CONFIG\_UUDECODE \\
  \bottomrule
\end{tabularx}

\pagebreak

\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & vmstat.c\\
  Line & 51\\
  Description & Uninitialized variable: \texttt{name}\\
  & Uninitialized variable: \texttt{p}\\
  Number of Configurations & 508\\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=51-70, firstnumber=51]{code/vmstat.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & Technically True\\
  Remarks & See the report for \texttt{chvt.c:24}.\\
  Features & CONFIG\_VMSTAT \\
  \bottomrule
\end{tabularx}

\pagebreak

\section{False Reports}

\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & lsm.h \\
  Line & 63 \\
  Description & Uninitialized variable: result \\
  Number of Configurations & 432\footnote{The actual cppcheck bug reports listed various C source code files which included this header as the source of the bug, even though \texttt{lsm.h} was the actual source. This is the number of total occurrences of the bug across multiple files.}\\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=55-64, firstnumber=55]{code/lsm.h}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & False\\
  Remarks & In configurations including \texttt{TOYBOX\_SMACK} and \texttt{TOYBOX\_SELINUX} \texttt{smack\_new\_label\_from\_self} and \texttt{getcon} are replaced with the value -1, respectively. In other configurations, \texttt{*result} is an out parameter. \\
  \bottomrule
\end{tabularx}

\pagebreak

\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & base64.c\\
  Line & 35\\
  Description & Expression \texttt{`this.base64.columns\&\&++*x == this.base64.columns'} \\ & depends on order of evaluation of side effects. \\
  Number of Configurations & 478 \\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=31-39, firstnumber=31]{code/base64.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & False\\
  Remarks & Although \texttt{TT.columns} appears twice in the same expression, it is modified neither time. Thus, the order of evaluation of side effects does not matter. \\
  \bottomrule
\end{tabularx}

\pagebreak

\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & tail.c\\
  Line & 188\\
  Description & Memory is allocated but not initialized: \texttt{try}\\
  Number of Configurations & 655\\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\lstinputlisting[firstline=181,lastline=188,firstnumber=181]{code/tail.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & False\\
  Remarks & The \texttt{for} loop causing cppcheck to give a warning is actually only testing \texttt{try[count]} for equality.\\
  \bottomrule
\end{tabularx}

\pagebreak

\noindent\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & args.c\\
  Line & 309\\
  Description & Uninitialized variable: \texttt{temp}\\
  Number of Configurations & 519\\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[firstline=301, lastline=309, firstnumber=301]{code/args.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
    Status & False\\
   Remarks & \texttt{temp} is necessarily initialized by either a call to \texttt{strol} or \texttt{strod}.\\
  \bottomrule
\end{tabularx}

\pagebreak

\begin{tabularx}{\textwidth}{rY}
  \toprule
  File & lib.c\\
  Line & 975\\
  Description & Buffer is accessed out of bounds: \texttt{``xwr''}\\
  Number of Configurations & 986\\
  \midrule
  \multicolumn{2}{c}{Code Sample} \\
\end{tabularx}
\noindent\lstinputlisting[linerange=965-977, firstnumber=965]{code/lib.c}
\noindent\begin{tabularx}{\textwidth}{rY}
  \midrule
  Status & False\\
  Remarks & \texttt{``xwr''} will never be accessed out of bounds. \texttt{c} is assigned by the expression \texttt{c = i \% 3}, which will give \texttt{c} the value of 0, 1, or 2.\\
  \bottomrule
\end{tabularx}

\pagebreak

\end{document}
